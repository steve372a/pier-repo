<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pier Repo - è½¯ä»¶ä»“åº“é¢„è§ˆ</title>
    <style>
        :root { --primary: #0366d6; --bg: #f6f8fa; --text: #24292e; }
        body { font-family: -apple-system, system-ui, sans-serif; line-height: 1.6; max-width: 900px; margin: 40px auto; padding: 0 20px; color: var(--text); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eaecef; padding-bottom: 10px; }
        .badge { font-size: 12px; background: #2ea44f; color: white; padding: 2px 8px; border-radius: 10px; }
        .search-container { margin: 20px 0; position: relative; }
        #search-input { width: 100%; padding: 12px 40px 12px 15px; font-size: 16px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .lang-switch { font-size: 0.9em; color: var(--primary); cursor: pointer; }
        .stats-card { background: var(--bg); border: 1px solid #e1e4e8; border-radius: 6px; padding: 15px; margin-bottom: 20px; display: flex; gap: 20px; }
        .preview-container { border: 1px solid #e1e4e8; border-radius: 6px; background: #1b1f23; position: relative; }
        #preview { color: #e1e4e8; padding: 15px; margin: 0; overflow: auto; font-family: monospace; max-height: 600px; white-space: pre-wrap; }
        .no-result { color: #888; text-align: center; padding: 20px; }
        .en { display: none; } /* é»˜è®¤æ˜¾ç¤ºä¸­æ–‡ */
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ“¦ Pier Repo <span class="badge">Live</span></h1>
    <div class="lang-switch" onclick="toggleLang()">English / ä¸­æ–‡</div>
</div>

<div class="stats-card">
    <div>
        <span class="zh">ğŸ“Š è½¯ä»¶åŒ…æ€»æ•°ï¼š</span><span class="en">ğŸ“Š Total Packages:</span>
        <strong id="pkg-count">...</strong>
    </div>
    <div>
        <span class="zh">ğŸ”— åŸå§‹æ–‡ä»¶ï¼š</span><span class="en">ğŸ”— Raw Files:</span>
        <a href="db.sque" target="_blank">db.sque</a>
    </div>
</div>

<div class="search-container">
    <input type="text" id="search-input" placeholder="è¾“å…¥å…³é”®å­—æ¨¡ç³Šæœç´¢... / Search packages..." oninput="doSearch()">
</div>

<div class="preview-container">
    <pre id="preview">Loading data...</pre>
</div>

<script>
    let allData = []; // å­˜å‚¨åŸå§‹è¡Œæ•°æ®
    let isEnglish = false;

    // 1. åˆå§‹åŒ–è¯»å–æ•°æ®
    Promise.all([
        fetch('dbm.sque').then(r => r.text()),
        fetch('db.sque').then(r => r.text())
    ]).then(([count, content]) => {
        document.getElementById('pkg-count').textContent = count.trim();
        allData = content.split('\n').filter(line => line.trim() !== "");
        render(allData);
    }).catch(err => {
        document.getElementById('preview').innerHTML = `<span style="color:red">Error: ${err.message}</span>`;
    });

    // 2. æ¨¡ç³Šæœç´¢é€»è¾‘
    function doSearch() {
        const term = document.getElementById('search-input').value.toLowerCase();
        // æ¨¡ç³Šè¿‡æ»¤ï¼šåªè¦è¡Œå†…å®¹åŒ…å«è¾“å…¥å­—ç¬¦å³å¯
        const filtered = allData.filter(line => line.toLowerCase().includes(term));
        render(filtered);
    }

    // 3. æ¸²æŸ“åˆ—è¡¨
    function render(data) {
        const container = document.getElementById('preview');
        if (data.length === 0) {
            container.innerHTML = '<div class="no-result">æ— åŒ¹é…ç»“æœ / No results found</div>';
            return;
        }
        // é‡æ–°æ‹¼åˆæ–‡æœ¬å±•ç¤ºï¼Œä¿ç•™åŸæœ‰æ’åº
        container.textContent = data.join('\n');
    }

    // 4. ä¸­è‹±æ–‡åˆ‡æ¢
    function toggleLang() {
        isEnglish = !isEnglish;
        const zhEls = document.querySelectorAll('.zh');
        const enEls = document.querySelectorAll('.en');
        const input = document.getElementById('search-input');

        if (isEnglish) {
            zhEls.forEach(el => el.style.display = 'none');
            enEls.forEach(el => el.style.display = 'inline');
            input.placeholder = "Type to search...";
        } else {
            zhEls.forEach(el => el.style.display = 'inline');
            enEls.forEach(el => el.style.display = 'none');
            input.placeholder = "è¾“å…¥å…³é”®å­—æ¨¡ç³Šæœç´¢...";
        }
    }
</script>
</body>
</html>
